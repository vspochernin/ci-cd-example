name: CI/CD Pipeline

on:
    push:
        branches:
            - master

jobs:
    build:
        runs-on: ubuntu-latest
        steps:
            - name: Checkout code
              uses: actions/checkout@v4

            - name: Setup JDK 17
              uses: actions/setup-java@v4
              with:
                  distribution: 'temurin'
                  java-version: '17'

            - name: Build with Maven
              run: mvn clean package

            - name: Archive build
              uses: actions/upload-artifact@v4
              with:
                  name: my-app
                  path: target/*.jar

    test:
        runs-on: ${{ matrix.os }}
        strategy:
            matrix:
                os: [ubuntu-latest, windows-latest, macos-latest]
        needs: build
        steps:
            - name: Checkout code
              uses: actions/checkout@v4

            - name: Setup JDK 17
              uses: actions/setup-java@v4
              with:
                  distribution: 'temurin'
                  java-version: '17'

            - name: Download build artifact
              uses: actions/download-artifact@v2
              with:
                  name: my-app

            - name: Run tests
              run: mvn test
